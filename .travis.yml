sudo: required

services:
  - docker

install:
  - export TRAVIS_REPO_OWNER=${TRAVIS_REPO_SLUG%/*}
  - export TRAVIS_REPO_NAME=${TRAVIS_REPO_SLUG#*/}
  - docker build -t microsoft/ell:latest --build-arg branch=$TRAVIS_PULL_REQUEST_BRANCH https://github.com/$TRAVIS_REPO_OWNER/ELL.git.

script:
  # hack to install openmpi because docker runs out of memory
  - docker run -it microsoft/ell:latest /bin/sh -c 'cd /openmpi-1.10.3; make -j all; make install; cd /ELL/build; ctest -VV'
